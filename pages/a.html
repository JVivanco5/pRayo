<!DOCTYPE html>
<html>
<head>
 
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
 
<script>
 
    $(document).ready(function(){
        $("#msg").hide();
        $("#PedirClima").click(function(){
 
 
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(showPosition);
                } else { 
                    console.log("Geolocation is not supported by this browser.");
            }
        })
        function showPosition(position) {
            //console.log("Latitude: " + position.coords.latitude + " Longitude: " + position.coords.longitude);
            var lat = position.coords.latitude;
            var lon = position.coords.longitude;
            var urlBase = "https://www.metaweather.com/api/location/search/?lattlong="
            var urlFormateada = `${urlBase}${lat},${lon}`;
            console.log(urlFormateada);
            $.get(urlFormateada,function(Listadelugares){
                var urlWoeid = "https://www.metaweather.com/api/location/".concat(Listadelugares[0].woeid);
                console.log(Listadelugares[0].woeid)
                console.log(urlWoeid)
                $.get(urlWoeid,function(tiempo){
                    console.log(tiempo.consolidated_weather[0])
                    var maxTemp = Math.round(tiempo.consolidated_weather[0].the_temp)
                    console.log(maxTemp)
                    //weather_state_abbr
                    var urlIcono = "https://www.metaweather.com/".concat("/static/img/weather/ico/"+tiempo.consolidated_weather[0].weather_state_abbr+".ico")
                    console.log(urlIcono)
                    var mensaje = `<div><img src="${urlIcono}">${maxTemp}Â°C</div>`
                    $("#Mensaje").append(mensaje);
                })
            })
            //$("#msg").show();
            //$("#Mensaje").append(mensaje);
 
    }
    })
 
 
 
    </script>
 
</head>
 
    <body>
            <h1>Clima</h1>
 
            <button id="PedirClima" class="btn btn-primary">Pedir Clima</button>
          <div id="Mensaje">
 
          </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
    </body>
</html>